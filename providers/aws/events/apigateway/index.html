<!doctype html><html lang="en"><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="viewport" content="width=device-width, initial-scale=1" /><link rel="stylesheet" href="/phenomic.browser.74f4a4b5a2e5af5372a1.css" /><meta data-react-helmet="true" name="generator" content="Phenomic 0.18.1"/><meta data-react-helmet="true" property="og:site_name" content="PhenomicDemo1"/><meta data-react-helmet="true" name="twitter:site" content="@"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Serverless Framework - AWS Lambda Events - API Gateway"/><meta data-react-helmet="true" property="og:url" content="http://phenomcidemo1.com/providers/aws/events/apigateway/"/><meta data-react-helmet="true" property="og:description" content="Setting up AWS API Gateway Events with AWS Lambda via the Serverless Framework"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Serverless Framework - AWS Lambda Events - API Gateway"/><meta data-react-helmet="true" name="twitter:creator" content="@"/><meta data-react-helmet="true" name="twitter:description" content="Setting up AWS API Gateway Events with AWS Lambda via the Serverless Framework"/><meta data-react-helmet="true" name="description" content="Setting up AWS API Gateway Events with AWS Lambda via the Serverless Framework"/><title data-react-helmet="true">Serverless Framework - AWS Lambda Events - API Gateway</title></head><body><div id="phenomic"><div class="_1RdlK" data-reactroot="" data-reactid="1" data-react-checksum="-1054451779"><div hidden="" data-reactid="2"><!-- react-empty: 3 --><!-- react-empty: 4 --><style data-reactid="5">@-ms-viewport { width: device-width; }</style></div><header class="_2FSyU" data-reactid="6"><nav class="_3LSR3" data-reactid="7"><div class="_3AJay" data-reactid="8"><a class="UWcAH" href="/" data-reactid="9">Home</a></div><div class="_3X6jh" data-reactid="10"><!-- react-text: 11 --><!-- /react-text --><!-- react-text: 12 --><!-- /react-text --></div></nav></header><div class="_3SQKJ" data-reactid="13"><div class="_1V853" data-reactid="14"><!-- react-empty: 15 --><h1 class="_2wBO_" data-reactid="16">Serverless Framework - AWS Lambda Events - API Gateway</h1><div class="phenomic-BodyContainer" data-reactid="17"><!-- DOCS-SITE-LINK:START automatically generated  -->
### [Read this on the main serverless docs site](https://www.serverless.com/framework/docs/providers/aws/events/apigateway)
<!-- DOCS-SITE-LINK:END -->
<h1 id="api-gateway"><a href="#api-gateway" class="phenomic-HeadingAnchor">#</a>API Gateway</h1>
<p>To create HTTP endpoints as Event sources for your AWS Lambda Functions, use the Serverless Framework's easy AWS API Gateway Events syntax.</p>
<p>There are two ways you can configure your HTTP endpoints to integrate with your AWS Lambda Functions:</p>
<ul>
<li>lambda-proxy (Recommended)</li>
<li>lambda</li>
</ul>
<p>The difference between these is <code>lambda-proxy</code> automatically passes the content of the HTTP request into your AWS Lambda function (headers, body, etc.) and allows you to configure your response (headers, status code, body) in the code of your AWS Lambda Function.  Whereas, the <code>lambda</code> method makes you explicitly define headers, status codes, and more in the configuration of each API Gateway Endpoint (not in code).  We highly recommend using the <code>lambda-proxy</code> method if it supports your use-case, since the <code>lambda</code> method is highly tedious.</p>
<p>By default, the Framework uses the <code>lambda-proxy</code> method (i.e., everything is passed into your Lambda), and nothing is required by you to enable it.</p>
<h2 id="lambda-proxy-integration"><a href="#lambda-proxy-integration" class="phenomic-HeadingAnchor">#</a>Lambda Proxy Integration</h2>
<h3 id="simple-http-endpoint"><a href="#simple-http-endpoint" class="phenomic-HeadingAnchor">#</a>Simple HTTP Endpoint</h3>
<p>This setup specifies that the <code>index</code> function should be run when someone accesses the API gateway at <code>users/index</code> via
a <code>GET</code> request.</p>
<p>Here's an example:</p>
<pre><code class="hljs language-yml"><span class="hljs-comment"># serverless.yml</span>
<span class="hljs-attr">functions:</span>
<span class="hljs-attr">  index:</span>
<span class="hljs-attr">    handler:</span> users.index
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span> GET users/index</code></pre>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// users.js</span>
<span class="hljs-meta">
'use strict'</span>;

exports.handler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, context, callback</span>) </span>{

    <span class="hljs-built_in">console</span>.log(event); <span class="hljs-comment">// Contains incoming request data (e.g., query params, headers and more)</span>

    <span class="hljs-keyword">const</span> response = {
      <span class="hljs-attr">statusCode</span>: <span class="hljs-number">200</span>,
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">"x-custom-header"</span> : <span class="hljs-string">"My Header Value"</span>
      },
      <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify({ <span class="hljs-string">"message"</span>: <span class="hljs-string">"Hello World!"</span> })
    };

    callback(<span class="hljs-literal">null</span>, response);
};</code></pre>
<p><strong>Note:</strong> When the body is a JSON-Document, you must parse it yourself:</p>
<pre><code>JSON.parse(event.body);
</code></pre>
<h3 id="http-endpoint-with-extended-options"><a href="#http-endpoint-with-extended-options" class="phenomic-HeadingAnchor">#</a>HTTP Endpoint with Extended Options</h3>
<p>Here we've defined an POST endpoint for the path <code>posts/create</code>.</p>
<pre><code class="hljs language-yml"><span class="hljs-comment"># serverless.yml</span>
<span class="hljs-attr">functions:</span>
<span class="hljs-attr">  create:</span>
<span class="hljs-attr">    handler:</span> posts.create
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          path:</span> posts/create
<span class="hljs-attr">          method:</span> post</code></pre>
<h3 id="enabling-cors"><a href="#enabling-cors" class="phenomic-HeadingAnchor">#</a>Enabling CORS</h3>
<p>To set CORS configurations for your HTTP endpoints, simply modify your event configurations as follows:</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">functions:</span>
<span class="hljs-attr">  hello:</span>
<span class="hljs-attr">    handler:</span> handler.hello
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          path:</span> user/create
<span class="hljs-attr">          method:</span> get
<span class="hljs-attr">          cors:</span> <span class="hljs-literal">true</span></code></pre>
<p>If you want to use CORS with the lambda-proxy integration, remember to include <code>Access-Control-Allow-Origin</code> in your returned headers object, like this:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// users.js</span>
<span class="hljs-meta">
'use strict'</span>;

exports.handler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, context, callback</span>) </span>{

    <span class="hljs-keyword">const</span> response = {
      <span class="hljs-attr">statusCode</span>: <span class="hljs-number">200</span>,
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">"Access-Control-Allow-Origin"</span> : <span class="hljs-string">"*"</span> <span class="hljs-comment">// Required for CORS support to work</span>
      },
      <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify({ <span class="hljs-string">"message"</span>: <span class="hljs-string">"Hello World!"</span> })
    };

    callback(<span class="hljs-literal">null</span>, response);
};</code></pre>
<h3 id="http-endpoints-with-custom-authorizers"><a href="#http-endpoints-with-custom-authorizers" class="phenomic-HeadingAnchor">#</a>HTTP Endpoints with Custom Authorizers</h3>
<p>Custom Authorizers allow you to run an AWS Lambda Function before your targeted AWS Lambda Function.  This is useful for Microservice Architectures or when you simply want to do some Authorization before running your business logic.</p>
<p>You can enable Custom Authorizers for your HTTP endpoint by setting the Authorizer in your <code>http</code> event to another function
in the same service, as shown in the following example:</p>
<pre><code class="hljs language-yml"><span class="hljs-comment"># serverless.yml</span>
<span class="hljs-attr">functions:</span>
<span class="hljs-attr">  create:</span>
<span class="hljs-attr">    handler:</span> posts.create
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          path:</span> posts/create
<span class="hljs-attr">          method:</span> post
<span class="hljs-attr">          authorizer:</span> authorizerFunc
<span class="hljs-attr">  authorizerFunc:</span>
<span class="hljs-attr">    handler:</span> handlers.authorizerFunc</code></pre>
<p>Or, if you want to configure the Authorizer with more options, you can turn the <code>authorizer</code> property into an object as
shown in the following example:</p>
<pre><code class="hljs language-yml"><span class="hljs-comment"># serverless.yml</span>
<span class="hljs-attr">functions:</span>
<span class="hljs-attr">  create:</span>
<span class="hljs-attr">    handler:</span> posts.create
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          path:</span> posts/create
<span class="hljs-attr">          method:</span> post
<span class="hljs-attr">          authorizer:</span>
<span class="hljs-attr">            name:</span> authorizerFunc
<span class="hljs-attr">            resultTtlInSeconds:</span> <span class="hljs-number">0</span>
<span class="hljs-attr">            identitySource:</span> method.request.header.Authorization
<span class="hljs-attr">            identityValidationExpression:</span> someRegex
<span class="hljs-attr">  authorizerFunc:</span>
<span class="hljs-attr">    handler:</span> handlers.authorizerFunc</code></pre>
<p>If the Authorizer function does not exist in your service but exists in AWS, you can provide the ARN of the Lambda
function instead of the function name, as shown in the following example:</p>
<pre><code class="hljs language-yml"><span class="hljs-comment"># serverless.yml</span>
<span class="hljs-attr">functions:</span>
<span class="hljs-attr">  create:</span>
<span class="hljs-attr">    handler:</span> posts.create
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          path:</span> posts/create
<span class="hljs-attr">          method:</span> post
<span class="hljs-attr">          authorizer:</span> xxx:xxx:Lambda-Name</code></pre>
<p>Or, if you want to configure the Authorizer with more options, you can turn the <code>authorizer</code> property into an object as
shown in the following example:</p>
<pre><code class="hljs language-yml"><span class="hljs-comment"># serverless.yml</span>
<span class="hljs-attr">functions:</span>
<span class="hljs-attr">  create:</span>
<span class="hljs-attr">    handler:</span> posts.create
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          path:</span> posts/create
<span class="hljs-attr">          method:</span> post
<span class="hljs-attr">          authorizer:</span>
<span class="hljs-attr">            arn:</span> xxx:xxx:Lambda-Name
<span class="hljs-attr">            resultTtlInSeconds:</span> <span class="hljs-number">0</span>
<span class="hljs-attr">            identitySource:</span> method.request.header.Authorization
<span class="hljs-attr">            identityValidationExpression:</span> someRegex</code></pre>
<h3 id="catching-exceptions-in-your-lambda-function"><a href="#catching-exceptions-in-your-lambda-function" class="phenomic-HeadingAnchor">#</a>Catching Exceptions In Your Lambda Function</h3>
<p>In case an exception is thrown in your lambda function AWS will send an error message with <code>Process exited before completing request</code>. This will be caught by the regular expression for the 500 HTTP status and the 500 status will be returned.</p>
<h3 id="setting-api-keys-for-your-rest-api"><a href="#setting-api-keys-for-your-rest-api" class="phenomic-HeadingAnchor">#</a>Setting API keys for your Rest API</h3>
<p>You can specify a list of API keys to be used by your service Rest API by adding an <code>apiKeys</code> array property to the
<code>provider</code> object in <code>serverless.yml</code>. You'll also need to explicitly specify which endpoints are <code>private</code> and require
one of the api keys to be included in the request by adding a <code>private</code> boolean property to the <code>http</code> event object you
want to set as private. API Keys are created globally, so if you want to deploy your service to different stages make sure
your API key contains a stage variable as defined below.</p>
<p>Here's an example configuration for setting API keys for your service Rest API:</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">service:</span> my-service
<span class="hljs-attr">provider:</span>
<span class="hljs-attr">  name:</span> aws
<span class="hljs-attr">  apiKeys:</span>
<span class="hljs-bullet">    -</span> myFirstKey
<span class="hljs-bullet">    -</span> ${opt:stage}-myFirstKey
<span class="hljs-bullet">    -</span> ${env:MY_API_KEY} <span class="hljs-comment"># you can hide it in a serverless variable</span>
<span class="hljs-attr">functions:</span>
<span class="hljs-attr">  hello:</span>
<span class="hljs-attr">  events:</span>
<span class="hljs-attr">    - http:</span>
<span class="hljs-attr">        path:</span> user/create
<span class="hljs-attr">        method:</span> get
<span class="hljs-attr">        private:</span> <span class="hljs-literal">true</span></code></pre>
<p>Please note that those are the API keys names, not the actual values. Once you deploy your service, the value of those API keys will be auto generated by AWS and printed on the screen for you to use.</p>
<p>Clients connecting to this Rest API will then need to set any of these API keys values in the <code>x-api-key</code> header of their request. This is only necessary for functions where the <code>private</code> property is set to true.</p>
<h2 id="lambda-integration"><a href="#lambda-integration" class="phenomic-HeadingAnchor">#</a>Lambda Integration</h2>
<p>This method is more complicated and involves a lot more configuration of the <code>http</code> event syntax.</p>
<h3 id="request-parameters"><a href="#request-parameters" class="phenomic-HeadingAnchor">#</a>Request Parameters</h3>
<p>To pass optional and required parameters to your functions, so you can use them in API Gateway tests and SDK generation, marking them as <code>true</code> will make them required, <code>false</code> will make them optional.</p>
<pre><code class="hljs language-yml"><span class="hljs-comment"># serverless.yml</span>
<span class="hljs-attr">functions:</span>
<span class="hljs-attr">  create:</span>
<span class="hljs-attr">    handler:</span> posts.create
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          path:</span> posts/create
<span class="hljs-attr">          method:</span> post
<span class="hljs-attr">          integration:</span> lambda
<span class="hljs-attr">          request:</span>
<span class="hljs-attr">            parameters:</span>
<span class="hljs-attr">              querystrings:</span>
<span class="hljs-attr">                url:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">              headers:</span>
<span class="hljs-attr">                foo:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">                bar:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">              paths:</span>
<span class="hljs-attr">                bar:</span> <span class="hljs-literal">false</span></code></pre>
<p>In order for path variables to work, API Gateway also needs them in the method path itself, like so:</p>
<pre><code class="hljs language-yml"><span class="hljs-comment"># serverless.yml</span>
<span class="hljs-attr">functions:</span>
<span class="hljs-attr">  create:</span>
<span class="hljs-attr">    handler:</span> posts.post_detail
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          path:</span> posts/{id}
<span class="hljs-attr">          method:</span> get
<span class="hljs-attr">          integration:</span> lambda
<span class="hljs-attr">          request:</span>
<span class="hljs-attr">            parameters:</span>
<span class="hljs-attr">              paths:</span>
<span class="hljs-attr">                id:</span> <span class="hljs-literal">true</span></code></pre>
<h3 id="request-templates"><a href="#request-templates" class="phenomic-HeadingAnchor">#</a>Request templates</h3>
<h4 id="default-request-templates"><a href="#default-request-templates" class="phenomic-HeadingAnchor">#</a>Default Request Templates</h4>
<p>Serverless ships with the following default request templates you can use out of the box:</p>
<ol>
<li><code>application/json</code></li>
<li><code>application/x-www-form-urlencoded</code></li>
</ol>
<p>Both templates give you access to the following properties you can access with the help of the <code>event</code> object:</p>
<ul>
<li>body</li>
<li>method</li>
<li>principalId</li>
<li>stage</li>
<li>headers</li>
<li>query</li>
<li>path</li>
<li>identity</li>
<li>stageVariables</li>
</ul>
<h4 id="custom-request-templates"><a href="#custom-request-templates" class="phenomic-HeadingAnchor">#</a>Custom Request Templates</h4>
<p>However you can define and use your own request templates as follows (you can even overwrite the default request templates
by defining a new request template for an existing content type):</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">functions:</span>
<span class="hljs-attr">  create:</span>
<span class="hljs-attr">    handler:</span> posts.create
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          method:</span> get
<span class="hljs-attr">          path:</span> whatever
<span class="hljs-attr">          request:</span>
<span class="hljs-attr">            template:</span>
              text/xhtml: <span class="hljs-string">'{ "stage" : "$context.stage" }'</span>
              application/json: <span class="hljs-string">'{ "httpMethod" : "$context.httpMethod" }'</span></code></pre>
<p><strong>Note:</strong> The templates are defined as plain text here. However you can also reference an external file with the help of the <code>${file(templatefile)}</code> syntax.</p>
<p><strong>Note 2:</strong> In .yml, strings containing <code>:</code>, <code>{</code>, <code>}</code>, <code>[</code>, <code>]</code>, <code>,</code>, <code>&#x26;</code>, <code>*</code>, <code>#</code>, <code>?</code>, <code>|</code>, <code>-</code>, <code>&#x3C;</code>, <code>></code>, <code>=</code>, <code>!</code>, <code>%</code>, <code>@</code>, <code>`</code> must be quoted.</p>
<p>If you want to map querystrings to the event object, you can use the <code>$input.params('hub.challenge')</code> syntax from API Gateway, as follows:</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">functions:</span>
<span class="hljs-attr">  create:</span>
<span class="hljs-attr">    handler:</span> posts.create
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          method:</span> get
<span class="hljs-attr">          path:</span> whatever
<span class="hljs-attr">          request:</span>
<span class="hljs-attr">            template:</span>
              application/json: <span class="hljs-string">'{ "foo" : "$input.params('</span><span class="hljs-string">'bar'</span><span class="hljs-string">')" }'</span></code></pre>
<p><strong>Note:</strong> Notice when using single-quoted strings, any single quote <code>'</code> inside its contents must be doubled (<code>''</code>) to escape it.
You can then access the query string <code>https://example.com/dev/whatever?bar=123</code> by <code>event.foo</code> in the lambda function.
If you want to spread a string into multiple lines, you can use the <code>></code> or <code>|</code> syntax, but the following strings have to be all indented with the same amount, <a href="http://stackoverflow.com/questions/3790454/in-yaml-how-do-i-break-a-string-over-multiple-lines">read more about <code>></code> syntax</a>.</p>
<h4 id="pass-through-behavior"><a href="#pass-through-behavior" class="phenomic-HeadingAnchor">#</a>Pass Through Behavior</h4>
<p>API Gateway provides multiple ways to handle requests where the Content-Type header does not match any of the specified mapping templates.  When this happens, the request payload will either be passed through the integration request <em>without transformation</em> or rejected with a <code>415 - Unsupported Media Type</code>, depending on the configuration.</p>
<p>You can define this behavior as follows (if not specified, a value of <strong>NEVER</strong> will be used):</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">functions:</span>
<span class="hljs-attr">  create:</span>
<span class="hljs-attr">    handler:</span> posts.create
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          method:</span> get
<span class="hljs-attr">          path:</span> whatever
<span class="hljs-attr">          request:</span>
<span class="hljs-attr">            passThrough:</span> NEVER</code></pre>
<p>There are 3 available options:</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Passed Through When</th>
<th>Rejected When</th>
</tr>
</thead>
<tbody>
<tr>
<td>NEVER</td>
<td>Never</td>
<td>No templates defined or Content-Type does not match a defined template</td>
</tr>
<tr>
<td>WHEN_NO_MATCH</td>
<td>Content-Type does not match defined template</td>
<td>Never</td>
</tr>
<tr>
<td>WHEN_NO_TEMPLATES</td>
<td>No templates were defined</td>
<td>One or more templates defined, but Content-Type does not match</td>
</tr>
</tbody>
</table>
<p>See the <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-mapping-template-reference.html#integration-passthrough-behaviors">api gateway documentation</a> for detailed descriptions of these options.</p>
<p><strong>Notes:</strong></p>
<ul>
<li>A missing/empty request Content-Type is considered to be the API Gateway default (<code>application/json</code>)</li>
<li>API Gateway docs refer to "WHEN_NO_TEMPLATE" (singular), but this will fail during creation as the actual value should be "WHEN_NO_TEMPLATES" (plural)</li>
</ul>
<h3 id="responses"><a href="#responses" class="phenomic-HeadingAnchor">#</a>Responses</h3>
<p>Serverless lets you setup custom headers and a response template for your <code>http</code> event.</p>
<h4 id="custom-response-headers"><a href="#custom-response-headers" class="phenomic-HeadingAnchor">#</a>Custom Response Headers</h4>
<p>Here's an example which shows you how you can setup a custom response header:</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">functions:</span>
<span class="hljs-attr">  create:</span>
<span class="hljs-attr">    handler:</span> posts.create
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          method:</span> get
<span class="hljs-attr">          path:</span> whatever
<span class="hljs-attr">          response:</span>
<span class="hljs-attr">            headers:</span>
<span class="hljs-attr">              Content-Type:</span> integration.response.header.Content-Type
<span class="hljs-attr">              Cache-Control:</span> <span class="hljs-string">"'max-age=120'"</span></code></pre>
<p><strong>Note:</strong> You're able to use the <a href="http://docs.aws.amazon.com/apigateway/latest/developerguide/request-response-data-mappings.html#mapping-response-parameters">integration response variables</a>
for your header values. Headers are passed to API Gateway exactly like you define them. Passing the <code>Cache-Control</code> header
as <code>"'max-age=120'"</code> means API Gateway will receive the value as <code>'max-age=120'</code> (enclosed with single quotes).</p>
<h3 id="custom-response-templates"><a href="#custom-response-templates" class="phenomic-HeadingAnchor">#</a>Custom Response Templates</h3>
<p>Sometimes you'll want to define a custom response template API Gateway should use to transform your lambdas output.
Here's an example which will transform the return value of your lambda so that the browser renders it as HTML:</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">functions:</span>
<span class="hljs-attr">  create:</span>
<span class="hljs-attr">    handler:</span> posts.create
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          method:</span> get
<span class="hljs-attr">          path:</span> whatever
<span class="hljs-attr">          response:</span>
<span class="hljs-attr">            headers:</span>
<span class="hljs-attr">              Content-Type:</span> <span class="hljs-string">"'text/html'"</span>
<span class="hljs-attr">            template:</span> $input.path(<span class="hljs-string">'$'</span>)</code></pre>
<p><strong>Note:</strong> The template is defined as plain text here. However you can also reference an external file with the help of
the <code>${file(templatefile)}</code> syntax.</p>
<h3 id="status-codes"><a href="#status-codes" class="phenomic-HeadingAnchor">#</a>Status codes</h3>
<p>Serverless ships with default status codes you can use to e.g. signal that a resource could not be found (404) or that
the user is not authorized to perform the action (401). Those status codes are regex definitions that will be added to your API Gateway configuration.</p>
<h4 id="available-status-codes"><a href="#available-status-codes" class="phenomic-HeadingAnchor">#</a>Available Status Codes</h4>
<table>
<thead>
<tr>
<th>Status Code</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>Bad Request</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
</tr>
<tr>
<td>422</td>
<td>Unprocessable Entity</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error</td>
</tr>
<tr>
<td>502</td>
<td>Bad Gateway</td>
</tr>
<tr>
<td>504</td>
<td>Gateway Timeout</td>
</tr>
</tbody>
</table>
<h4 id="using-status-codes"><a href="#using-status-codes" class="phenomic-HeadingAnchor">#</a>Using Status Codes</h4>
<p>To return a given status code you simply need to add square brackets with the status code of your choice to your
returned message like this: <code>[401] You are not authorized to access this resource!</code>.</p>
<p>Here's an example which shows you how you can raise a 404 HTTP status from within your lambda function.</p>
<pre><code class="hljs language-javascript"><span class="hljs-built_in">module</span>.exports.hello = <span class="hljs-function">(<span class="hljs-params">event, context, cb</span>) =></span> {
  cb(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'[404] Not found'</span>));
}</code></pre>
<h4 id="custom-status-codes"><a href="#custom-status-codes" class="phenomic-HeadingAnchor">#</a>Custom Status Codes</h4>
<p>You can override the defaults status codes supplied by Serverless. You can use this to change the default status code, add/remove status codes, or change the templates and headers used for each status code. Use the pattern key to change the selection process that dictates what code is returned.</p>
<p>If you specify a status code with a pattern of '' that will become the default response code. See below on how to change the default to 201 for post requests.</p>
<p>If you omit any default status code. A standard default 200 status code will be generated for you.</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">functions:</span>
<span class="hljs-attr">  create:</span>
<span class="hljs-attr">    handler:</span> posts.create
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          method:</span> post
<span class="hljs-attr">          path:</span> whatever
<span class="hljs-attr">          response:</span>
<span class="hljs-attr">            headers:</span>
<span class="hljs-attr">              Content-Type:</span> <span class="hljs-string">"'text/html'"</span>
<span class="hljs-attr">            template:</span> $input.path(<span class="hljs-string">'$'</span>)
<span class="hljs-attr">            statusCodes:</span>
                <span class="hljs-number">201</span>:
<span class="hljs-attr">                    pattern:</span> <span class="hljs-string">''</span> <span class="hljs-comment"># Default response method</span>
                <span class="hljs-number">409</span>:
<span class="hljs-attr">                    pattern:</span> <span class="hljs-string">'.*"statusCode":409,.*'</span> <span class="hljs-comment"># JSON response</span>
<span class="hljs-attr">                    template:</span> $input.path(<span class="hljs-string">"$.errorMessage"</span>) <span class="hljs-comment"># JSON return object</span>
<span class="hljs-attr">                    headers:</span>
<span class="hljs-attr">                      Content-Type:</span> <span class="hljs-string">"'application/json+hal'"</span></code></pre>
<p>You can also create varying response templates for each code and content type by creating an object with the key as the content type</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">functions:</span>
<span class="hljs-attr">  create:</span>
<span class="hljs-attr">    handler:</span> posts.create
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          method:</span> post
<span class="hljs-attr">          path:</span> whatever
<span class="hljs-attr">          response:</span>
<span class="hljs-attr">            headers:</span>
<span class="hljs-attr">              Content-Type:</span> <span class="hljs-string">"'text/html'"</span>
<span class="hljs-attr">            template:</span> $input.path(<span class="hljs-string">'$'</span>)
<span class="hljs-attr">            statusCodes:</span>
                <span class="hljs-number">201</span>:
<span class="hljs-attr">                    pattern:</span> <span class="hljs-string">''</span> <span class="hljs-comment"># Default response method</span>
                <span class="hljs-number">409</span>:
<span class="hljs-attr">                    pattern:</span> <span class="hljs-string">'.*"statusCode":409,.*'</span> <span class="hljs-comment"># JSON response</span>
<span class="hljs-attr">                    template:</span>
                      application/json: $input.path(<span class="hljs-string">"$.errorMessage"</span>) <span class="hljs-comment"># JSON return object</span>
                      application/xml: $input.path(<span class="hljs-string">"$.body.errorMessage"</span>) <span class="hljs-comment"># XML return object</span>
<span class="hljs-attr">                    headers:</span>
<span class="hljs-attr">                      Content-Type:</span> <span class="hljs-string">"'application/json+hal'"</span></code></pre>
<h2 id="enabling-cors-with-the-lambda-integration-method"><a href="#enabling-cors-with-the-lambda-integration-method" class="phenomic-HeadingAnchor">#</a>Enabling CORS with the Lambda Integration Method</h2>
<pre><code class="hljs language-yml"><span class="hljs-attr">functions:</span>
<span class="hljs-attr">  hello:</span>
<span class="hljs-attr">    handler:</span> handler.hello
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          path:</span> user/create
<span class="hljs-attr">          method:</span> get
<span class="hljs-attr">          cors:</span> <span class="hljs-literal">true</span></code></pre>
<p>You can equally set your own attributes:</p>
<pre><code class="hljs language-yml"><span class="hljs-attr">functions:</span>
<span class="hljs-attr">  hello:</span>
<span class="hljs-attr">    handler:</span> handler.hello
<span class="hljs-attr">    events:</span>
<span class="hljs-attr">      - http:</span>
<span class="hljs-attr">          path:</span> user/create
<span class="hljs-attr">          method:</span> get
<span class="hljs-attr">          cors:</span>
<span class="hljs-attr">            origins:</span>
<span class="hljs-bullet">              -</span> <span class="hljs-string">'*'</span>
<span class="hljs-attr">            headers:</span>
<span class="hljs-bullet">              -</span> Content-Type
<span class="hljs-bullet">              -</span> X-Amz-Date
<span class="hljs-bullet">              -</span> Authorization
<span class="hljs-bullet">              -</span> X-Api-Key
<span class="hljs-bullet">              -</span> X-Amz-Security-Token</code></pre>
<p>This example is the default setting and is exactly the same as the previous example. The <code>Access-Control-Allow-Methods</code> header is set automatically, based on the endpoints specified in your service configuration with CORS enabled.</p>
<p><strong>Note:</strong> If you are using the default lambda proxy integration, remember to include <code>Access-Control-Allow-Origin</code> in your returned headers object otherwise CORS will fail.</p>
<pre><code>module.exports.hello = (event, context, cb) => {
  return cb(null, {
    statusCode: 200,
    headers: {
      'Access-Control-Allow-Origin': '*'
    },
    body: 'Hello World!'
  });
}
</code></pre>
<h2 id="setting-an-http-proxy-on-api-gateway"><a href="#setting-an-http-proxy-on-api-gateway" class="phenomic-HeadingAnchor">#</a>Setting an HTTP Proxy on API Gateway</h2>
<p>To set up an HTTP proxy, you'll need two CloudFormation templates, one for the endpoint (known as resource in CF), and
one for method. These two templates will work together to construct your proxy. So if you want to set <code>your-app.com/serverless</code> as a proxy for <code>serverless.com</code>, you'll need the following two templates in your <code>serverless.yml</code>:</p>
<pre><code class="hljs language-yml"><span class="hljs-comment"># serverless.yml</span>
<span class="hljs-attr">service:</span> service-name
<span class="hljs-attr">provider:</span> aws
<span class="hljs-attr">functions:</span>
  …

<span class="hljs-attr">resources:</span>
<span class="hljs-attr">  Resources:</span>
<span class="hljs-attr">    ProxyResource:</span>
<span class="hljs-attr">      Type:</span> AWS::ApiGateway::Resource
<span class="hljs-attr">      Properties:</span>
<span class="hljs-attr">        ParentId:</span>
<span class="hljs-attr">          Fn:</span>:GetAtt:
<span class="hljs-bullet">            -</span> ApiGatewayRestApi <span class="hljs-comment"># our default Rest API logical ID</span>
<span class="hljs-bullet">            -</span> RootResourceId
<span class="hljs-attr">        PathPart:</span> serverless <span class="hljs-comment"># the endpoint in your API that is set as proxy</span>
<span class="hljs-attr">        RestApiId:</span>
<span class="hljs-attr">          Ref:</span> ApiGatewayRestApi
<span class="hljs-attr">    ProxyMethod:</span>
<span class="hljs-attr">      Type:</span> AWS::ApiGateway::Method
<span class="hljs-attr">      Properties:</span>
<span class="hljs-attr">        ResourceId:</span>
<span class="hljs-attr">          Ref:</span> ProxyResource
<span class="hljs-attr">        RestApiId:</span>
<span class="hljs-attr">          Ref:</span> ApiGatewayRestApi
<span class="hljs-attr">        HttpMethod:</span> GET <span class="hljs-comment"># the method of your proxy. Is it GET or POST or … ?</span>
<span class="hljs-attr">        MethodResponses:</span>
<span class="hljs-attr">          - StatusCode:</span> <span class="hljs-number">200</span>
<span class="hljs-attr">        Integration:</span>
<span class="hljs-attr">          IntegrationHttpMethod:</span> POST
<span class="hljs-attr">          Type:</span> HTTP
<span class="hljs-attr">          Uri:</span> http://serverless.com <span class="hljs-comment"># the URL you want to set a proxy to</span>
<span class="hljs-attr">          IntegrationResponses:</span>
<span class="hljs-attr">            - StatusCode:</span> <span class="hljs-number">200</span></code></pre>
<p>There's a lot going on in these two templates, but all you need to know to set up a simple proxy is setting the method &#x26;
endpoint of your proxy, and the URI you want to set a proxy to.</p>
<p>Now that you have these two CloudFormation templates defined in your <code>serverless.yml</code> file, you can simply run
<code>serverless deploy</code> and that will deploy these custom resources for you along with your service and set up a proxy on your Rest API.</p>
</div></div></div><footer class="_1BvTd" data-reactid="18"><p data-reactid="19"><a href="https://github.com/MoOx/phenomic#readme" class="_1a1P_" data-reactid="20"><!-- react-text: 21 -->Website generated with <!-- /react-text --><span class="_2b3UD" data-reactid="22">&lt;Phenomic /&gt;</span></a></p></footer></div></div><script>window.__COLLECTION__ = [{"layout":"PageError","route":"404.html","description":"Content here not used, see src/layouts/PageError","__filename":"404.md","__url":"/404.html","__resourceUrl":"/404.html","__dataUrl":"/404.html.c51e41dcf93740dd221b7da7702623a9.json"},{"title":"Documentation","layout":"Homepage","description":"The Serverless Framework allows you to deploy auto-scaling, pay-per-execution, event-driven functions to any cloud.  We currently support…","__filename":"index.md","__url":"/","__resourceUrl":"/index.html","__dataUrl":"/index.html.9d6d4d7f67ddac85bde8b7359493fb00.json"},{"title":"First Post","date":"2016-01-22T00:00:00.000Z","layout":"Post","description":"This is the first post! Code is highlighted by default.","__filename":"posts\\first-post.md","__url":"/posts/first-post/","__resourceUrl":"/posts/first-post/index.html","__dataUrl":"/posts/first-post/index.html.09d9cb922929bf066db6b640939485a4.json"},{"title":"Hello World!","date":"2016-02-14T00:00:00.000Z","layout":"Post","description":"Hello there. Here is another dumb post.","__filename":"posts\\hello-world.md","__url":"/posts/hello-world/","__resourceUrl":"/posts/hello-world/index.html","__dataUrl":"/posts/hello-world/index.html.71dba0e386497410490147d8e028e650.json"},{"title":"Serverless Framework Commands - AWS Lambda - Create","menuText":"Create","menuOrder":1,"description":"Creates a new Service in your current working directory","layout":"Page","__filename":"providers\\aws\\cli-reference\\create.md","__url":"/providers/aws/cli-reference/create/","__resourceUrl":"/providers/aws/cli-reference/create/index.html","__dataUrl":"/providers/aws/cli-reference/create/index.html.b036f914fe49765f2aa232b72cd13c5e.json"},{"title":"Serverless Framework Commands - AWS Lambda - Deploy","menuText":"Deploy","menuOrder":3,"description":"Deploy your service to the specified provider","layout":"Page","__filename":"providers\\aws\\cli-reference\\deploy.md","__url":"/providers/aws/cli-reference/deploy/","__resourceUrl":"/providers/aws/cli-reference/deploy/index.html","__dataUrl":"/providers/aws/cli-reference/deploy/index.html.4e5038ebff52854b3fda337469faea60.json"},{"title":"Serverless Framework Commands - AWS Lambda - Info","menuText":"Info","menuOrder":6,"description":"Display information about your deployed service and the AWS Lambda Functions, Events and AWS Resources it contains.","layout":"Page","__filename":"providers\\aws\\cli-reference\\info.md","__url":"/providers/aws/cli-reference/info/","__resourceUrl":"/providers/aws/cli-reference/info/index.html","__dataUrl":"/providers/aws/cli-reference/info/index.html.5ed12d870d932d4de7ca61be2e13d985.json"},{"title":"Serverless Framework Commands - AWS Lambda - Install","menuText":"Install","menuOrder":2,"description":"Install pre-written AWS Lambda Functions, Events and Resources with the Serverless Framework","layout":"Page","__filename":"providers\\aws\\cli-reference\\install.md","__url":"/providers/aws/cli-reference/install/","__resourceUrl":"/providers/aws/cli-reference/install/index.html","__dataUrl":"/providers/aws/cli-reference/install/index.html.4884dae55d8cb803dba34dd034c22a21.json"},{"title":"Serverless Framework Commands - AWS Lambda - Invoke","menuText":"Invoke","menuOrder":4,"description":"Invoke an AWS Lambda Function using the Serverless Framework","layout":"Page","__filename":"providers\\aws\\cli-reference\\invoke.md","__url":"/providers/aws/cli-reference/invoke/","__resourceUrl":"/providers/aws/cli-reference/invoke/index.html","__dataUrl":"/providers/aws/cli-reference/invoke/index.html.561cbb8f63a8e87acf050a57a29400c3.json"},{"title":"Serverless Framework Commands - AWS Lambda - Logs","menuText":"Logs","menuOrder":5,"description":"View logs of your AWS Lambda Function within your terminal using the Serverless Framework","layout":"Page","__filename":"providers\\aws\\cli-reference\\logs.md","__url":"/providers/aws/cli-reference/logs/","__resourceUrl":"/providers/aws/cli-reference/logs/index.html","__dataUrl":"/providers/aws/cli-reference/logs/index.html.5d9915ff3e5fc2e6515efd212745042b.json"},{"title":"Serverless - AWS Lambda - CLI Reference","menuText":"AWS","layout":"Page","description":"Serverless AWS Lambda CLI Reference Welcome to the Serverless AWS Lambda CLI Reference!  Please select a section on the left to get…","__filename":"providers\\aws\\cli-reference\\readme.md","__url":"/providers/aws/cli-reference/readme/","__resourceUrl":"/providers/aws/cli-reference/readme/index.html","__dataUrl":"/providers/aws/cli-reference/readme/index.html.30d0b25fe7716f8d5e63debc21f49448.json"},{"title":"Serverless Framework Commands - AWS Lambda - Remove","menuText":"Remove","menuOrder":7,"description":"Remove a deployed Service and all of its AWS Lambda Functions, Events and Resources","layout":"Page","__filename":"providers\\aws\\cli-reference\\remove.md","__url":"/providers/aws/cli-reference/remove/","__resourceUrl":"/providers/aws/cli-reference/remove/index.html","__dataUrl":"/providers/aws/cli-reference/remove/index.html.7a90e097f62394c8b36f12f9f29d3382.json"},{"title":"Serverless Rollback CLI Command","menuText":"Rollback","menuOrder":9,"description":"Rollback the Serverless service to a specific deployment","layout":"Page","__filename":"providers\\aws\\cli-reference\\rollback.md","__url":"/providers/aws/cli-reference/rollback/","__resourceUrl":"/providers/aws/cli-reference/rollback/index.html","__dataUrl":"/providers/aws/cli-reference/rollback/index.html.220fc0520d479e002f8324d483998572.json"},{"title":"Serverless Framework Commands - AWS Lambda - Serverless Stats","menuText":"Serverless Stats","menuOrder":8,"description":"Enables or disables Serverless Statistic logging within the Serverless Framework.","layout":"Page","__filename":"providers\\aws\\cli-reference\\slstats.md","__url":"/providers/aws/cli-reference/slstats/","__resourceUrl":"/providers/aws/cli-reference/slstats/index.html","__dataUrl":"/providers/aws/cli-reference/slstats/index.html.c3beb8ebe120b1a16ad46557d99180dc.json"},{"title":"Serverless Framework - AWS Lambda Events - API Gateway","menuText":"API Gateway","menuOrder":1,"description":"Setting up AWS API Gateway Events with AWS Lambda via the Serverless Framework","layout":"Page","__filename":"providers\\aws\\events\\apigateway.md","__url":"/providers/aws/events/apigateway/","__resourceUrl":"/providers/aws/events/apigateway/index.html","__dataUrl":"/providers/aws/events/apigateway/index.html.ca154daffac2c19ba3842e68da373332.json"},{"title":"Serverless - AWS Lambda - Events","menuText":"AWS","layout":"Page","description":"Serverless AWS Lambda Events Welcome to the Serverless AWS Lambda Events Glossary!  Please select a section on the left to get started.…","__filename":"providers\\aws\\events\\index.md","__url":"/providers/aws/events/","__resourceUrl":"/providers/aws/events/index.html","__dataUrl":"/providers/aws/events/index.html.e41f3e432daadd5f1793f38771f451b6.json"},{"title":"Serverless Framework - AWS Lambda Events - S3","menuText":"S3","menuOrder":3,"description":"Setting up AWS S3 Events with AWS Lambda via the Serverless Framework","layout":"Page","__filename":"providers\\aws\\events\\s3.md","__url":"/providers/aws/events/s3/","__resourceUrl":"/providers/aws/events/s3/index.html","__dataUrl":"/providers/aws/events/s3/index.html.dd942664e184888af89dea21240b14da.json"},{"title":"Serverless Framework - AWS Lambda Events - Scheduled & Recurring","menuText":"Schedule","menuOrder":4,"description":"Setting up Scheduled, Recurring, CRON Task Events with AWS Lambda via the Serverless Framework","layout":"Page","__filename":"providers\\aws\\events\\schedule.md","__url":"/providers/aws/events/schedule/","__resourceUrl":"/providers/aws/events/schedule/index.html","__dataUrl":"/providers/aws/events/schedule/index.html.8af9acd122d9f9faec181c8d7fe1496b.json"},{"title":"Serverless Framework - AWS Lambda Events - SNS","menuText":"SNS","menuOrder":5,"description":"Setting up AWS SNS Events with AWS Lambda via the Serverless Framework","layout":"Page","__filename":"providers\\aws\\events\\sns.md","__url":"/providers/aws/events/sns/","__resourceUrl":"/providers/aws/events/sns/index.html","__dataUrl":"/providers/aws/events/sns/index.html.cbec6cdaa4de3488cdae9369747aa0a5.json"},{"title":"Serverless Framework - AWS Lambda Events - Kinesis & DynamoDB Streams","menuText":"Kinesis & DynamoDB","menuOrder":2,"description":"Setting up AWS Kinesis Streams and AWS DynamoDB Streams Events with AWS Lambda via the Serverless Framework","layout":"Page","__filename":"providers\\aws\\events\\streams.md","__url":"/providers/aws/events/streams/","__resourceUrl":"/providers/aws/events/streams/index.html","__dataUrl":"/providers/aws/events/streams/index.html.fa108736998b661e6c6f2bc59dc4f8c1.json"},{"title":"Cron Example","menuText":"Cron Example","description":"Create a Serverless cron job","layout":"Page","__filename":"providers\\aws\\examples\\cron\\index.md","__url":"/providers/aws/examples/cron/","__resourceUrl":"/providers/aws/examples/cron/index.html","__dataUrl":"/providers/aws/examples/cron/index.html.31bdf93c78cd5afe94034961f15b6d09.json"},{"title":"JavaScript Cron Example","menuText":"JavaScript Cron Example","description":"Create a Serverless scheduled cron job with Node.js","layout":"Page","__filename":"providers\\aws\\examples\\cron\\node\\index.md","__url":"/providers/aws/examples/cron/node/","__resourceUrl":"/providers/aws/examples/cron/node/index.html","__dataUrl":"/providers/aws/examples/cron/node/index.html.128246e0ff4e96704a08a107b1de741f.json"},{"title":"Hello World Example","menuText":"Hello World Example","description":"Example of creating a Hello World function in Node.js and Python with the Serverless framework","layout":"Page","__filename":"providers\\aws\\examples\\hello-world\\index.md","__url":"/providers/aws/examples/hello-world/","__resourceUrl":"/providers/aws/examples/hello-world/index.html","__dataUrl":"/providers/aws/examples/hello-world/index.html.1d0360591c941ba23f32317b0f337655.json"},{"title":"Hello World Node.js Example","menuText":"Hello World Node.js Example","description":"Create a Node.js Hello World Lambda function","layout":"Page","__filename":"providers\\aws\\examples\\hello-world\\node\\index.md","__url":"/providers/aws/examples/hello-world/node/","__resourceUrl":"/providers/aws/examples/hello-world/node/index.html","__dataUrl":"/providers/aws/examples/hello-world/node/index.html.29bdaa8e1c041db769c6a97cfbc8082c.json"},{"title":"Hello World Python Example","menuText":"Hello World Python Example","description":"Create a simple Python powered Lambda function","layout":"Page","__filename":"providers\\aws\\examples\\hello-world\\python\\index.md","__url":"/providers/aws/examples/hello-world/python/","__resourceUrl":"/providers/aws/examples/hello-world/python/index.html","__dataUrl":"/providers/aws/examples/hello-world/python/index.html.0bd6e062ccaa13df88ebf1fc329f4aea.json"},{"title":"Serverless - AWS Lambda - Examples","menuText":"AWS","layout":"Page","description":"Serverless AWS Lambda Examples Welcome to the Serverless Amazon Web Services Examples! Please select an example below: Hello World Using…","__filename":"providers\\aws\\examples\\index.md","__url":"/providers/aws/examples/","__resourceUrl":"/providers/aws/examples/index.html","__dataUrl":"/providers/aws/examples/index.html.f138cd0162cddefb4102e107655b7911.json"},{"title":"Using External Libraries","menuText":"Using External Libraries","description":"Example of Using External Libraries in NodeJS and Python with the serverless framework","layout":"Page","__filename":"providers\\aws\\examples\\using-external-libraries\\index.md","__url":"/providers/aws/examples/using-external-libraries/","__resourceUrl":"/providers/aws/examples/using-external-libraries/index.html","__dataUrl":"/providers/aws/examples/using-external-libraries/index.html.ac471f93f7bc463b4cc8709382bfcad6.json"},{"title":"Using External libraries in Node.js Example","menuText":"External libraries in Node.js","description":"Create a Node.js using external libraries Lambda function","layout":"Page","__filename":"providers\\aws\\examples\\using-external-libraries\\node\\index.md","__url":"/providers/aws/examples/using-external-libraries/node/","__resourceUrl":"/providers/aws/examples/using-external-libraries/node/index.html","__dataUrl":"/providers/aws/examples/using-external-libraries/node/index.html.6f151688227333653882879611a67aa2.json"},{"title":"Serving HTML through API Gateway Example","menuText":"Serving HTML Example","description":"Example of serving HTML page through API Gateway","layout":"Page","__filename":"providers\\aws\\examples\\web-serving-html\\index.md","__url":"/providers/aws/examples/web-serving-html/","__resourceUrl":"/providers/aws/examples/web-serving-html/index.html","__dataUrl":"/providers/aws/examples/web-serving-html/index.html.3382f7b1edb850467108bb6d77404ff0.json"},{"title":"Serving HTML in Node.js through API Gateway Example","menuText":"Serving HTML in Node.js Example","layout":"Page","description":"Serving HTML in Node.js through API Gateway Example This is an example of serving vanilla HTML/CSS/JS through API Gateway.","__filename":"providers\\aws\\examples\\web-serving-html\\node\\index.md","__url":"/providers/aws/examples/web-serving-html/node/","__resourceUrl":"/providers/aws/examples/web-serving-html/node/index.html","__dataUrl":"/providers/aws/examples/web-serving-html/node/index.html.06a29f4a08f29fcf1ff8f9b045dba3a1.json"},{"title":"Serverless Framework - AWS Lambda Guide - Credentials","menuText":"Credentials","menuOrder":3,"description":"How to set up the Serverless Framework with your Amazon Web Services credentials","layout":"Page","__filename":"providers\\aws\\guide\\credentials.md","__url":"/providers/aws/guide/credentials/","__resourceUrl":"/providers/aws/guide/credentials/index.html","__dataUrl":"/providers/aws/guide/credentials/index.html.bd0d7c4e3667b16d58588e596aba3720.json"},{"title":"Serverless Framework - AWS Lambda Guide - Deploying","menuText":"Deploying","menuOrder":8,"description":"How to deploy your AWS Lambda functions and their required infrastructure","layout":"Page","__filename":"providers\\aws\\guide\\deploying.md","__url":"/providers/aws/guide/deploying/","__resourceUrl":"/providers/aws/guide/deploying/index.html","__dataUrl":"/providers/aws/guide/deploying/index.html.1315d2246fe07465f5ebb145e8c08191.json"},{"title":"Serverless Framework - AWS Lambda Guide - Events","menuText":"Events","menuOrder":6,"description":"Configuring AWS Lambda function events in the Serverless Framework","layout":"Page","__filename":"providers\\aws\\guide\\events.md","__url":"/providers/aws/guide/events/","__resourceUrl":"/providers/aws/guide/events/index.html","__dataUrl":"/providers/aws/guide/events/index.html.b7e590c1de61d60a546f5d479c22d1ed.json"},{"title":"Serverless Framework - AWS Lambda Guide - Functions","menuText":"Functions","menuOrder":5,"description":"How to configure AWS Lambda functions in the Serverless Framework","layout":"Page","__filename":"providers\\aws\\guide\\functions.md","__url":"/providers/aws/guide/functions/","__resourceUrl":"/providers/aws/guide/functions/index.html","__dataUrl":"/providers/aws/guide/functions/index.html.06c90a63d85bdd20b564df5861b2ae62.json"},{"title":"Serverless - AWS Guide","menuText":"AWS","layout":"Page","description":"Serverless AWS Lambda Guide Welcome to the Serverless AWS Lambda Guide!  Please select a section on the left to get started. Note: Before…","__filename":"providers\\aws\\guide\\index.md","__url":"/providers/aws/guide/","__resourceUrl":"/providers/aws/guide/index.html","__dataUrl":"/providers/aws/guide/index.html.3dc194b9a60d758e513c1d25aafc7a23.json"},{"title":"Serverless Framework - AWS Lambda Guide - Installing The Serverless Framework","menuText":"Installation","menuOrder":2,"description":"How to install the Serverless Framework and start using AWS Lambda","layout":"Page","__filename":"providers\\aws\\guide\\installation.md","__url":"/providers/aws/guide/installation/","__resourceUrl":"/providers/aws/guide/installation/index.html","__dataUrl":"/providers/aws/guide/installation/index.html.8af505f5a3d6c9d5648d7bbf58bfe6ef.json"},{"title":"Serverless Framework - AWS Lambda Guide - Introduction","menuText":"Intro","menuOrder":1,"description":"An introduction to using AWS and AWS Lambda with the Serverless Framework.","layout":"Page","__filename":"providers\\aws\\guide\\intro.md","__url":"/providers/aws/guide/intro/","__resourceUrl":"/providers/aws/guide/intro/index.html","__dataUrl":"/providers/aws/guide/intro/index.html.a46783eaa228881bbe2b080bcaa75a05.json"},{"title":"Serverless Framework Guide - AWS Lambda Guide - Packaging","menuText":"Packaging","menuOrder":11,"description":"How the Serverless Framework packages your AWS Lambda functions and other available options","layout":"Page","__filename":"providers\\aws\\guide\\packaging.md","__url":"/providers/aws/guide/packaging/","__resourceUrl":"/providers/aws/guide/packaging/index.html","__dataUrl":"/providers/aws/guide/packaging/index.html.7a8d744de718e83803ae2be21a10614f.json"},{"title":"Serverless Framework - AWS Lambda Guide - Plugins","menuText":"Plugins","menuOrder":12,"description":"How to install and create Plugins to extend or overwrite the functionality of the Serverless Framework","layout":"Page","__filename":"providers\\aws\\guide\\plugins.md","__url":"/providers/aws/guide/plugins/","__resourceUrl":"/providers/aws/guide/plugins/index.html","__dataUrl":"/providers/aws/guide/plugins/index.html.d5d107e3701022e68f09390c15e88aa9.json"},{"title":"Serverless Framework - AWS Lambda Guide - AWS Infrastructure Resources","menuText":"Resources","menuOrder":7,"description":"How to deploy and manage AWS infrastructure to use with your AWS Lambda functions with the Serverless Framework","layout":"Page","__filename":"providers\\aws\\guide\\resources.md","__url":"/providers/aws/guide/resources/","__resourceUrl":"/providers/aws/guide/resources/index.html","__dataUrl":"/providers/aws/guide/resources/index.html.373d7907a37cafdc81bf2eef79c7424e.json"},{"title":"Serverless Framework - AWS Lambda Guide - Services","menuText":"Services","menuOrder":4,"description":"How to manage and configure serverless services, which contain your AWS Lambda functions, their events and infrastructure resources.","layout":"Page","__filename":"providers\\aws\\guide\\services.md","__url":"/providers/aws/guide/services/","__resourceUrl":"/providers/aws/guide/services/index.html","__dataUrl":"/providers/aws/guide/services/index.html.226a528c5cbefa71116f32e9605e4eb9.json"},{"title":"Serverless Framework - AWS Lambda Guide - Testing","menuText":"Testing","menuOrder":9,"description":"Recommendations and best practices for testing AWS Lambda Functions with the Serverless Framework","layout":"Page","__filename":"providers\\aws\\guide\\testing.md","__url":"/providers/aws/guide/testing/","__resourceUrl":"/providers/aws/guide/testing/index.html","__dataUrl":"/providers/aws/guide/testing/index.html.de8ba35a8f0bdd35ce47e70b69ba2dcd.json"},{"title":"Serverless Framework - AWS Lambda Guide - Comparison Of Serverless Framework V.1 & V.0","menuText":"V.0 & V.1","menuOrder":15,"description":"A comparison of Serverless Framework V.1 and Serverless Framework V.0","layout":"Page","__filename":"providers\\aws\\guide\\v0_to_v1.md","__url":"/providers/aws/guide/v0_to_v1/","__resourceUrl":"/providers/aws/guide/v0_to_v1/index.html","__dataUrl":"/providers/aws/guide/v0_to_v1/index.html.47b3b43bcbc92df636068fae4acdf865.json"},{"title":"Serverless Variables","menuText":"Variables","menuOrder":10,"description":"How to use Serverless Variables to insert dynamic configuration info into your serverless.yml","layout":"Page","__filename":"providers\\aws\\guide\\variables.md","__url":"/providers/aws/guide/variables/","__resourceUrl":"/providers/aws/guide/variables/index.html","__dataUrl":"/providers/aws/guide/variables/index.html.c0ed8a6f61390b1ce3a0b0f42e28aa54.json"},{"title":"Serverless Framework - AWS Lambda Guide - Pinning the Serverless framework version","menuText":"Version pinning","menuOrder":14,"description":"How to pin a service to certain Serverless versions.","layout":"Page","__filename":"providers\\aws\\guide\\version.md","__url":"/providers/aws/guide/version/","__resourceUrl":"/providers/aws/guide/version/index.html","__dataUrl":"/providers/aws/guide/version/index.html.04909ba9464cd86a71b3b751ccdafee4.json"},{"title":"Serverless Framework Guide - AWS Lambda - Workflow","menuText":"Workflow","menuOrder":13,"description":"A guide and cheatsheet containing CLI commands and workflow recommendations.","layout":"Page","__filename":"providers\\aws\\guide\\workflow.md","__url":"/providers/aws/guide/workflow/","__resourceUrl":"/providers/aws/guide/workflow/index.html","__dataUrl":"/providers/aws/guide/workflow/index.html.cdb79debe41475ae8e0fddabf4e6dd25.json"},{"title":"Serverless - AWS Documentation","menuText":"AWS","layout":"Page","description":"Serverless AWS Provider Documentation Welcome to the Serverless Amazon Web Services documentation!  Please select a section on the left to…","__filename":"providers\\aws\\index.md","__url":"/providers/aws/","__resourceUrl":"/providers/aws/index.html","__dataUrl":"/providers/aws/index.html.c6abfccacd478fc8fc8456669afd8c53.json"},{"title":"Serverless - Infrastructure Providers","menuText":"Providers","layout":"Page","description":"Serverless Infrastructure Providers Providers are where your serverless functions run in the cloud. Under the hood, the serverless…","__filename":"providers\\index.md","__url":"/providers/","__resourceUrl":"/providers/index.html","__dataUrl":"/providers/index.html.288b8c05c0110762d00ff480174d8709.json"}];window.__INITIAL_STATE__ = {"pages":{"/providers/aws/events/apigateway/":{"head":{"title":"Serverless Framework - AWS Lambda Events - API Gateway","menuText":"API Gateway","menuOrder":1,"description":"Setting up AWS API Gateway Events with AWS Lambda via the Serverless Framework","layout":"Page"},"body":"<!-- DOCS-SITE-LINK:START automatically generated  -->\n### [Read this on the main serverless docs site](https://www.serverless.com/framework/docs/providers/aws/events/apigateway)\n<!-- DOCS-SITE-LINK:END -->\n<h1 id=\"api-gateway\"><a href=\"#api-gateway\" class=\"phenomic-HeadingAnchor\">#</a>API Gateway</h1>\n<p>To create HTTP endpoints as Event sources for your AWS Lambda Functions, use the Serverless Framework's easy AWS API Gateway Events syntax.</p>\n<p>There are two ways you can configure your HTTP endpoints to integrate with your AWS Lambda Functions:</p>\n<ul>\n<li>lambda-proxy (Recommended)</li>\n<li>lambda</li>\n</ul>\n<p>The difference between these is <code>lambda-proxy</code> automatically passes the content of the HTTP request into your AWS Lambda function (headers, body, etc.) and allows you to configure your response (headers, status code, body) in the code of your AWS Lambda Function.  Whereas, the <code>lambda</code> method makes you explicitly define headers, status codes, and more in the configuration of each API Gateway Endpoint (not in code).  We highly recommend using the <code>lambda-proxy</code> method if it supports your use-case, since the <code>lambda</code> method is highly tedious.</p>\n<p>By default, the Framework uses the <code>lambda-proxy</code> method (i.e., everything is passed into your Lambda), and nothing is required by you to enable it.</p>\n<h2 id=\"lambda-proxy-integration\"><a href=\"#lambda-proxy-integration\" class=\"phenomic-HeadingAnchor\">#</a>Lambda Proxy Integration</h2>\n<h3 id=\"simple-http-endpoint\"><a href=\"#simple-http-endpoint\" class=\"phenomic-HeadingAnchor\">#</a>Simple HTTP Endpoint</h3>\n<p>This setup specifies that the <code>index</code> function should be run when someone accesses the API gateway at <code>users/index</code> via\na <code>GET</code> request.</p>\n<p>Here's an example:</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-comment\"># serverless.yml</span>\n<span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  index:</span>\n<span class=\"hljs-attr\">    handler:</span> users.index\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span> GET users/index</code></pre>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// users.js</span>\n<span class=\"hljs-meta\">\n'use strict'</span>;\n\nexports.handler = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">event, context, callback</span>) </span>{\n\n    <span class=\"hljs-built_in\">console</span>.log(event); <span class=\"hljs-comment\">// Contains incoming request data (e.g., query params, headers and more)</span>\n\n    <span class=\"hljs-keyword\">const</span> response = {\n      <span class=\"hljs-attr\">statusCode</span>: <span class=\"hljs-number\">200</span>,\n      <span class=\"hljs-attr\">headers</span>: {\n        <span class=\"hljs-string\">\"x-custom-header\"</span> : <span class=\"hljs-string\">\"My Header Value\"</span>\n      },\n      <span class=\"hljs-attr\">body</span>: <span class=\"hljs-built_in\">JSON</span>.stringify({ <span class=\"hljs-string\">\"message\"</span>: <span class=\"hljs-string\">\"Hello World!\"</span> })\n    };\n\n    callback(<span class=\"hljs-literal\">null</span>, response);\n};</code></pre>\n<p><strong>Note:</strong> When the body is a JSON-Document, you must parse it yourself:</p>\n<pre><code>JSON.parse(event.body);\n</code></pre>\n<h3 id=\"http-endpoint-with-extended-options\"><a href=\"#http-endpoint-with-extended-options\" class=\"phenomic-HeadingAnchor\">#</a>HTTP Endpoint with Extended Options</h3>\n<p>Here we've defined an POST endpoint for the path <code>posts/create</code>.</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-comment\"># serverless.yml</span>\n<span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  create:</span>\n<span class=\"hljs-attr\">    handler:</span> posts.create\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          path:</span> posts/create\n<span class=\"hljs-attr\">          method:</span> post</code></pre>\n<h3 id=\"enabling-cors\"><a href=\"#enabling-cors\" class=\"phenomic-HeadingAnchor\">#</a>Enabling CORS</h3>\n<p>To set CORS configurations for your HTTP endpoints, simply modify your event configurations as follows:</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  hello:</span>\n<span class=\"hljs-attr\">    handler:</span> handler.hello\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          path:</span> user/create\n<span class=\"hljs-attr\">          method:</span> get\n<span class=\"hljs-attr\">          cors:</span> <span class=\"hljs-literal\">true</span></code></pre>\n<p>If you want to use CORS with the lambda-proxy integration, remember to include <code>Access-Control-Allow-Origin</code> in your returned headers object, like this:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// users.js</span>\n<span class=\"hljs-meta\">\n'use strict'</span>;\n\nexports.handler = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">event, context, callback</span>) </span>{\n\n    <span class=\"hljs-keyword\">const</span> response = {\n      <span class=\"hljs-attr\">statusCode</span>: <span class=\"hljs-number\">200</span>,\n      <span class=\"hljs-attr\">headers</span>: {\n        <span class=\"hljs-string\">\"Access-Control-Allow-Origin\"</span> : <span class=\"hljs-string\">\"*\"</span> <span class=\"hljs-comment\">// Required for CORS support to work</span>\n      },\n      <span class=\"hljs-attr\">body</span>: <span class=\"hljs-built_in\">JSON</span>.stringify({ <span class=\"hljs-string\">\"message\"</span>: <span class=\"hljs-string\">\"Hello World!\"</span> })\n    };\n\n    callback(<span class=\"hljs-literal\">null</span>, response);\n};</code></pre>\n<h3 id=\"http-endpoints-with-custom-authorizers\"><a href=\"#http-endpoints-with-custom-authorizers\" class=\"phenomic-HeadingAnchor\">#</a>HTTP Endpoints with Custom Authorizers</h3>\n<p>Custom Authorizers allow you to run an AWS Lambda Function before your targeted AWS Lambda Function.  This is useful for Microservice Architectures or when you simply want to do some Authorization before running your business logic.</p>\n<p>You can enable Custom Authorizers for your HTTP endpoint by setting the Authorizer in your <code>http</code> event to another function\nin the same service, as shown in the following example:</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-comment\"># serverless.yml</span>\n<span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  create:</span>\n<span class=\"hljs-attr\">    handler:</span> posts.create\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          path:</span> posts/create\n<span class=\"hljs-attr\">          method:</span> post\n<span class=\"hljs-attr\">          authorizer:</span> authorizerFunc\n<span class=\"hljs-attr\">  authorizerFunc:</span>\n<span class=\"hljs-attr\">    handler:</span> handlers.authorizerFunc</code></pre>\n<p>Or, if you want to configure the Authorizer with more options, you can turn the <code>authorizer</code> property into an object as\nshown in the following example:</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-comment\"># serverless.yml</span>\n<span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  create:</span>\n<span class=\"hljs-attr\">    handler:</span> posts.create\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          path:</span> posts/create\n<span class=\"hljs-attr\">          method:</span> post\n<span class=\"hljs-attr\">          authorizer:</span>\n<span class=\"hljs-attr\">            name:</span> authorizerFunc\n<span class=\"hljs-attr\">            resultTtlInSeconds:</span> <span class=\"hljs-number\">0</span>\n<span class=\"hljs-attr\">            identitySource:</span> method.request.header.Authorization\n<span class=\"hljs-attr\">            identityValidationExpression:</span> someRegex\n<span class=\"hljs-attr\">  authorizerFunc:</span>\n<span class=\"hljs-attr\">    handler:</span> handlers.authorizerFunc</code></pre>\n<p>If the Authorizer function does not exist in your service but exists in AWS, you can provide the ARN of the Lambda\nfunction instead of the function name, as shown in the following example:</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-comment\"># serverless.yml</span>\n<span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  create:</span>\n<span class=\"hljs-attr\">    handler:</span> posts.create\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          path:</span> posts/create\n<span class=\"hljs-attr\">          method:</span> post\n<span class=\"hljs-attr\">          authorizer:</span> xxx:xxx:Lambda-Name</code></pre>\n<p>Or, if you want to configure the Authorizer with more options, you can turn the <code>authorizer</code> property into an object as\nshown in the following example:</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-comment\"># serverless.yml</span>\n<span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  create:</span>\n<span class=\"hljs-attr\">    handler:</span> posts.create\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          path:</span> posts/create\n<span class=\"hljs-attr\">          method:</span> post\n<span class=\"hljs-attr\">          authorizer:</span>\n<span class=\"hljs-attr\">            arn:</span> xxx:xxx:Lambda-Name\n<span class=\"hljs-attr\">            resultTtlInSeconds:</span> <span class=\"hljs-number\">0</span>\n<span class=\"hljs-attr\">            identitySource:</span> method.request.header.Authorization\n<span class=\"hljs-attr\">            identityValidationExpression:</span> someRegex</code></pre>\n<h3 id=\"catching-exceptions-in-your-lambda-function\"><a href=\"#catching-exceptions-in-your-lambda-function\" class=\"phenomic-HeadingAnchor\">#</a>Catching Exceptions In Your Lambda Function</h3>\n<p>In case an exception is thrown in your lambda function AWS will send an error message with <code>Process exited before completing request</code>. This will be caught by the regular expression for the 500 HTTP status and the 500 status will be returned.</p>\n<h3 id=\"setting-api-keys-for-your-rest-api\"><a href=\"#setting-api-keys-for-your-rest-api\" class=\"phenomic-HeadingAnchor\">#</a>Setting API keys for your Rest API</h3>\n<p>You can specify a list of API keys to be used by your service Rest API by adding an <code>apiKeys</code> array property to the\n<code>provider</code> object in <code>serverless.yml</code>. You'll also need to explicitly specify which endpoints are <code>private</code> and require\none of the api keys to be included in the request by adding a <code>private</code> boolean property to the <code>http</code> event object you\nwant to set as private. API Keys are created globally, so if you want to deploy your service to different stages make sure\nyour API key contains a stage variable as defined below.</p>\n<p>Here's an example configuration for setting API keys for your service Rest API:</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">service:</span> my-service\n<span class=\"hljs-attr\">provider:</span>\n<span class=\"hljs-attr\">  name:</span> aws\n<span class=\"hljs-attr\">  apiKeys:</span>\n<span class=\"hljs-bullet\">    -</span> myFirstKey\n<span class=\"hljs-bullet\">    -</span> ${opt:stage}-myFirstKey\n<span class=\"hljs-bullet\">    -</span> ${env:MY_API_KEY} <span class=\"hljs-comment\"># you can hide it in a serverless variable</span>\n<span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  hello:</span>\n<span class=\"hljs-attr\">  events:</span>\n<span class=\"hljs-attr\">    - http:</span>\n<span class=\"hljs-attr\">        path:</span> user/create\n<span class=\"hljs-attr\">        method:</span> get\n<span class=\"hljs-attr\">        private:</span> <span class=\"hljs-literal\">true</span></code></pre>\n<p>Please note that those are the API keys names, not the actual values. Once you deploy your service, the value of those API keys will be auto generated by AWS and printed on the screen for you to use.</p>\n<p>Clients connecting to this Rest API will then need to set any of these API keys values in the <code>x-api-key</code> header of their request. This is only necessary for functions where the <code>private</code> property is set to true.</p>\n<h2 id=\"lambda-integration\"><a href=\"#lambda-integration\" class=\"phenomic-HeadingAnchor\">#</a>Lambda Integration</h2>\n<p>This method is more complicated and involves a lot more configuration of the <code>http</code> event syntax.</p>\n<h3 id=\"request-parameters\"><a href=\"#request-parameters\" class=\"phenomic-HeadingAnchor\">#</a>Request Parameters</h3>\n<p>To pass optional and required parameters to your functions, so you can use them in API Gateway tests and SDK generation, marking them as <code>true</code> will make them required, <code>false</code> will make them optional.</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-comment\"># serverless.yml</span>\n<span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  create:</span>\n<span class=\"hljs-attr\">    handler:</span> posts.create\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          path:</span> posts/create\n<span class=\"hljs-attr\">          method:</span> post\n<span class=\"hljs-attr\">          integration:</span> lambda\n<span class=\"hljs-attr\">          request:</span>\n<span class=\"hljs-attr\">            parameters:</span>\n<span class=\"hljs-attr\">              querystrings:</span>\n<span class=\"hljs-attr\">                url:</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-attr\">              headers:</span>\n<span class=\"hljs-attr\">                foo:</span> <span class=\"hljs-literal\">false</span>\n<span class=\"hljs-attr\">                bar:</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-attr\">              paths:</span>\n<span class=\"hljs-attr\">                bar:</span> <span class=\"hljs-literal\">false</span></code></pre>\n<p>In order for path variables to work, API Gateway also needs them in the method path itself, like so:</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-comment\"># serverless.yml</span>\n<span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  create:</span>\n<span class=\"hljs-attr\">    handler:</span> posts.post_detail\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          path:</span> posts/{id}\n<span class=\"hljs-attr\">          method:</span> get\n<span class=\"hljs-attr\">          integration:</span> lambda\n<span class=\"hljs-attr\">          request:</span>\n<span class=\"hljs-attr\">            parameters:</span>\n<span class=\"hljs-attr\">              paths:</span>\n<span class=\"hljs-attr\">                id:</span> <span class=\"hljs-literal\">true</span></code></pre>\n<h3 id=\"request-templates\"><a href=\"#request-templates\" class=\"phenomic-HeadingAnchor\">#</a>Request templates</h3>\n<h4 id=\"default-request-templates\"><a href=\"#default-request-templates\" class=\"phenomic-HeadingAnchor\">#</a>Default Request Templates</h4>\n<p>Serverless ships with the following default request templates you can use out of the box:</p>\n<ol>\n<li><code>application/json</code></li>\n<li><code>application/x-www-form-urlencoded</code></li>\n</ol>\n<p>Both templates give you access to the following properties you can access with the help of the <code>event</code> object:</p>\n<ul>\n<li>body</li>\n<li>method</li>\n<li>principalId</li>\n<li>stage</li>\n<li>headers</li>\n<li>query</li>\n<li>path</li>\n<li>identity</li>\n<li>stageVariables</li>\n</ul>\n<h4 id=\"custom-request-templates\"><a href=\"#custom-request-templates\" class=\"phenomic-HeadingAnchor\">#</a>Custom Request Templates</h4>\n<p>However you can define and use your own request templates as follows (you can even overwrite the default request templates\nby defining a new request template for an existing content type):</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  create:</span>\n<span class=\"hljs-attr\">    handler:</span> posts.create\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          method:</span> get\n<span class=\"hljs-attr\">          path:</span> whatever\n<span class=\"hljs-attr\">          request:</span>\n<span class=\"hljs-attr\">            template:</span>\n              text/xhtml: <span class=\"hljs-string\">'{ \"stage\" : \"$context.stage\" }'</span>\n              application/json: <span class=\"hljs-string\">'{ \"httpMethod\" : \"$context.httpMethod\" }'</span></code></pre>\n<p><strong>Note:</strong> The templates are defined as plain text here. However you can also reference an external file with the help of the <code>${file(templatefile)}</code> syntax.</p>\n<p><strong>Note 2:</strong> In .yml, strings containing <code>:</code>, <code>{</code>, <code>}</code>, <code>[</code>, <code>]</code>, <code>,</code>, <code>&#x26;</code>, <code>*</code>, <code>#</code>, <code>?</code>, <code>|</code>, <code>-</code>, <code>&#x3C;</code>, <code>></code>, <code>=</code>, <code>!</code>, <code>%</code>, <code>@</code>, <code>`</code> must be quoted.</p>\n<p>If you want to map querystrings to the event object, you can use the <code>$input.params('hub.challenge')</code> syntax from API Gateway, as follows:</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  create:</span>\n<span class=\"hljs-attr\">    handler:</span> posts.create\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          method:</span> get\n<span class=\"hljs-attr\">          path:</span> whatever\n<span class=\"hljs-attr\">          request:</span>\n<span class=\"hljs-attr\">            template:</span>\n              application/json: <span class=\"hljs-string\">'{ \"foo\" : \"$input.params('</span><span class=\"hljs-string\">'bar'</span><span class=\"hljs-string\">')\" }'</span></code></pre>\n<p><strong>Note:</strong> Notice when using single-quoted strings, any single quote <code>'</code> inside its contents must be doubled (<code>''</code>) to escape it.\nYou can then access the query string <code>https://example.com/dev/whatever?bar=123</code> by <code>event.foo</code> in the lambda function.\nIf you want to spread a string into multiple lines, you can use the <code>></code> or <code>|</code> syntax, but the following strings have to be all indented with the same amount, <a href=\"http://stackoverflow.com/questions/3790454/in-yaml-how-do-i-break-a-string-over-multiple-lines\">read more about <code>></code> syntax</a>.</p>\n<h4 id=\"pass-through-behavior\"><a href=\"#pass-through-behavior\" class=\"phenomic-HeadingAnchor\">#</a>Pass Through Behavior</h4>\n<p>API Gateway provides multiple ways to handle requests where the Content-Type header does not match any of the specified mapping templates.  When this happens, the request payload will either be passed through the integration request <em>without transformation</em> or rejected with a <code>415 - Unsupported Media Type</code>, depending on the configuration.</p>\n<p>You can define this behavior as follows (if not specified, a value of <strong>NEVER</strong> will be used):</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  create:</span>\n<span class=\"hljs-attr\">    handler:</span> posts.create\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          method:</span> get\n<span class=\"hljs-attr\">          path:</span> whatever\n<span class=\"hljs-attr\">          request:</span>\n<span class=\"hljs-attr\">            passThrough:</span> NEVER</code></pre>\n<p>There are 3 available options:</p>\n<table>\n<thead>\n<tr>\n<th>Value</th>\n<th>Passed Through When</th>\n<th>Rejected When</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>NEVER</td>\n<td>Never</td>\n<td>No templates defined or Content-Type does not match a defined template</td>\n</tr>\n<tr>\n<td>WHEN_NO_MATCH</td>\n<td>Content-Type does not match defined template</td>\n<td>Never</td>\n</tr>\n<tr>\n<td>WHEN_NO_TEMPLATES</td>\n<td>No templates were defined</td>\n<td>One or more templates defined, but Content-Type does not match</td>\n</tr>\n</tbody>\n</table>\n<p>See the <a href=\"https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-mapping-template-reference.html#integration-passthrough-behaviors\">api gateway documentation</a> for detailed descriptions of these options.</p>\n<p><strong>Notes:</strong></p>\n<ul>\n<li>A missing/empty request Content-Type is considered to be the API Gateway default (<code>application/json</code>)</li>\n<li>API Gateway docs refer to \"WHEN_NO_TEMPLATE\" (singular), but this will fail during creation as the actual value should be \"WHEN_NO_TEMPLATES\" (plural)</li>\n</ul>\n<h3 id=\"responses\"><a href=\"#responses\" class=\"phenomic-HeadingAnchor\">#</a>Responses</h3>\n<p>Serverless lets you setup custom headers and a response template for your <code>http</code> event.</p>\n<h4 id=\"custom-response-headers\"><a href=\"#custom-response-headers\" class=\"phenomic-HeadingAnchor\">#</a>Custom Response Headers</h4>\n<p>Here's an example which shows you how you can setup a custom response header:</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  create:</span>\n<span class=\"hljs-attr\">    handler:</span> posts.create\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          method:</span> get\n<span class=\"hljs-attr\">          path:</span> whatever\n<span class=\"hljs-attr\">          response:</span>\n<span class=\"hljs-attr\">            headers:</span>\n<span class=\"hljs-attr\">              Content-Type:</span> integration.response.header.Content-Type\n<span class=\"hljs-attr\">              Cache-Control:</span> <span class=\"hljs-string\">\"'max-age=120'\"</span></code></pre>\n<p><strong>Note:</strong> You're able to use the <a href=\"http://docs.aws.amazon.com/apigateway/latest/developerguide/request-response-data-mappings.html#mapping-response-parameters\">integration response variables</a>\nfor your header values. Headers are passed to API Gateway exactly like you define them. Passing the <code>Cache-Control</code> header\nas <code>\"'max-age=120'\"</code> means API Gateway will receive the value as <code>'max-age=120'</code> (enclosed with single quotes).</p>\n<h3 id=\"custom-response-templates\"><a href=\"#custom-response-templates\" class=\"phenomic-HeadingAnchor\">#</a>Custom Response Templates</h3>\n<p>Sometimes you'll want to define a custom response template API Gateway should use to transform your lambdas output.\nHere's an example which will transform the return value of your lambda so that the browser renders it as HTML:</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  create:</span>\n<span class=\"hljs-attr\">    handler:</span> posts.create\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          method:</span> get\n<span class=\"hljs-attr\">          path:</span> whatever\n<span class=\"hljs-attr\">          response:</span>\n<span class=\"hljs-attr\">            headers:</span>\n<span class=\"hljs-attr\">              Content-Type:</span> <span class=\"hljs-string\">\"'text/html'\"</span>\n<span class=\"hljs-attr\">            template:</span> $input.path(<span class=\"hljs-string\">'$'</span>)</code></pre>\n<p><strong>Note:</strong> The template is defined as plain text here. However you can also reference an external file with the help of\nthe <code>${file(templatefile)}</code> syntax.</p>\n<h3 id=\"status-codes\"><a href=\"#status-codes\" class=\"phenomic-HeadingAnchor\">#</a>Status codes</h3>\n<p>Serverless ships with default status codes you can use to e.g. signal that a resource could not be found (404) or that\nthe user is not authorized to perform the action (401). Those status codes are regex definitions that will be added to your API Gateway configuration.</p>\n<h4 id=\"available-status-codes\"><a href=\"#available-status-codes\" class=\"phenomic-HeadingAnchor\">#</a>Available Status Codes</h4>\n<table>\n<thead>\n<tr>\n<th>Status Code</th>\n<th>Meaning</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>400</td>\n<td>Bad Request</td>\n</tr>\n<tr>\n<td>401</td>\n<td>Unauthorized</td>\n</tr>\n<tr>\n<td>403</td>\n<td>Forbidden</td>\n</tr>\n<tr>\n<td>404</td>\n<td>Not Found</td>\n</tr>\n<tr>\n<td>422</td>\n<td>Unprocessable Entity</td>\n</tr>\n<tr>\n<td>500</td>\n<td>Internal Server Error</td>\n</tr>\n<tr>\n<td>502</td>\n<td>Bad Gateway</td>\n</tr>\n<tr>\n<td>504</td>\n<td>Gateway Timeout</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"using-status-codes\"><a href=\"#using-status-codes\" class=\"phenomic-HeadingAnchor\">#</a>Using Status Codes</h4>\n<p>To return a given status code you simply need to add square brackets with the status code of your choice to your\nreturned message like this: <code>[401] You are not authorized to access this resource!</code>.</p>\n<p>Here's an example which shows you how you can raise a 404 HTTP status from within your lambda function.</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-built_in\">module</span>.exports.hello = <span class=\"hljs-function\">(<span class=\"hljs-params\">event, context, cb</span>) =></span> {\n  cb(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Error</span>(<span class=\"hljs-string\">'[404] Not found'</span>));\n}</code></pre>\n<h4 id=\"custom-status-codes\"><a href=\"#custom-status-codes\" class=\"phenomic-HeadingAnchor\">#</a>Custom Status Codes</h4>\n<p>You can override the defaults status codes supplied by Serverless. You can use this to change the default status code, add/remove status codes, or change the templates and headers used for each status code. Use the pattern key to change the selection process that dictates what code is returned.</p>\n<p>If you specify a status code with a pattern of '' that will become the default response code. See below on how to change the default to 201 for post requests.</p>\n<p>If you omit any default status code. A standard default 200 status code will be generated for you.</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  create:</span>\n<span class=\"hljs-attr\">    handler:</span> posts.create\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          method:</span> post\n<span class=\"hljs-attr\">          path:</span> whatever\n<span class=\"hljs-attr\">          response:</span>\n<span class=\"hljs-attr\">            headers:</span>\n<span class=\"hljs-attr\">              Content-Type:</span> <span class=\"hljs-string\">\"'text/html'\"</span>\n<span class=\"hljs-attr\">            template:</span> $input.path(<span class=\"hljs-string\">'$'</span>)\n<span class=\"hljs-attr\">            statusCodes:</span>\n                <span class=\"hljs-number\">201</span>:\n<span class=\"hljs-attr\">                    pattern:</span> <span class=\"hljs-string\">''</span> <span class=\"hljs-comment\"># Default response method</span>\n                <span class=\"hljs-number\">409</span>:\n<span class=\"hljs-attr\">                    pattern:</span> <span class=\"hljs-string\">'.*\"statusCode\":409,.*'</span> <span class=\"hljs-comment\"># JSON response</span>\n<span class=\"hljs-attr\">                    template:</span> $input.path(<span class=\"hljs-string\">\"$.errorMessage\"</span>) <span class=\"hljs-comment\"># JSON return object</span>\n<span class=\"hljs-attr\">                    headers:</span>\n<span class=\"hljs-attr\">                      Content-Type:</span> <span class=\"hljs-string\">\"'application/json+hal'\"</span></code></pre>\n<p>You can also create varying response templates for each code and content type by creating an object with the key as the content type</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  create:</span>\n<span class=\"hljs-attr\">    handler:</span> posts.create\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          method:</span> post\n<span class=\"hljs-attr\">          path:</span> whatever\n<span class=\"hljs-attr\">          response:</span>\n<span class=\"hljs-attr\">            headers:</span>\n<span class=\"hljs-attr\">              Content-Type:</span> <span class=\"hljs-string\">\"'text/html'\"</span>\n<span class=\"hljs-attr\">            template:</span> $input.path(<span class=\"hljs-string\">'$'</span>)\n<span class=\"hljs-attr\">            statusCodes:</span>\n                <span class=\"hljs-number\">201</span>:\n<span class=\"hljs-attr\">                    pattern:</span> <span class=\"hljs-string\">''</span> <span class=\"hljs-comment\"># Default response method</span>\n                <span class=\"hljs-number\">409</span>:\n<span class=\"hljs-attr\">                    pattern:</span> <span class=\"hljs-string\">'.*\"statusCode\":409,.*'</span> <span class=\"hljs-comment\"># JSON response</span>\n<span class=\"hljs-attr\">                    template:</span>\n                      application/json: $input.path(<span class=\"hljs-string\">\"$.errorMessage\"</span>) <span class=\"hljs-comment\"># JSON return object</span>\n                      application/xml: $input.path(<span class=\"hljs-string\">\"$.body.errorMessage\"</span>) <span class=\"hljs-comment\"># XML return object</span>\n<span class=\"hljs-attr\">                    headers:</span>\n<span class=\"hljs-attr\">                      Content-Type:</span> <span class=\"hljs-string\">\"'application/json+hal'\"</span></code></pre>\n<h2 id=\"enabling-cors-with-the-lambda-integration-method\"><a href=\"#enabling-cors-with-the-lambda-integration-method\" class=\"phenomic-HeadingAnchor\">#</a>Enabling CORS with the Lambda Integration Method</h2>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  hello:</span>\n<span class=\"hljs-attr\">    handler:</span> handler.hello\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          path:</span> user/create\n<span class=\"hljs-attr\">          method:</span> get\n<span class=\"hljs-attr\">          cors:</span> <span class=\"hljs-literal\">true</span></code></pre>\n<p>You can equally set your own attributes:</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">functions:</span>\n<span class=\"hljs-attr\">  hello:</span>\n<span class=\"hljs-attr\">    handler:</span> handler.hello\n<span class=\"hljs-attr\">    events:</span>\n<span class=\"hljs-attr\">      - http:</span>\n<span class=\"hljs-attr\">          path:</span> user/create\n<span class=\"hljs-attr\">          method:</span> get\n<span class=\"hljs-attr\">          cors:</span>\n<span class=\"hljs-attr\">            origins:</span>\n<span class=\"hljs-bullet\">              -</span> <span class=\"hljs-string\">'*'</span>\n<span class=\"hljs-attr\">            headers:</span>\n<span class=\"hljs-bullet\">              -</span> Content-Type\n<span class=\"hljs-bullet\">              -</span> X-Amz-Date\n<span class=\"hljs-bullet\">              -</span> Authorization\n<span class=\"hljs-bullet\">              -</span> X-Api-Key\n<span class=\"hljs-bullet\">              -</span> X-Amz-Security-Token</code></pre>\n<p>This example is the default setting and is exactly the same as the previous example. The <code>Access-Control-Allow-Methods</code> header is set automatically, based on the endpoints specified in your service configuration with CORS enabled.</p>\n<p><strong>Note:</strong> If you are using the default lambda proxy integration, remember to include <code>Access-Control-Allow-Origin</code> in your returned headers object otherwise CORS will fail.</p>\n<pre><code>module.exports.hello = (event, context, cb) => {\n  return cb(null, {\n    statusCode: 200,\n    headers: {\n      'Access-Control-Allow-Origin': '*'\n    },\n    body: 'Hello World!'\n  });\n}\n</code></pre>\n<h2 id=\"setting-an-http-proxy-on-api-gateway\"><a href=\"#setting-an-http-proxy-on-api-gateway\" class=\"phenomic-HeadingAnchor\">#</a>Setting an HTTP Proxy on API Gateway</h2>\n<p>To set up an HTTP proxy, you'll need two CloudFormation templates, one for the endpoint (known as resource in CF), and\none for method. These two templates will work together to construct your proxy. So if you want to set <code>your-app.com/serverless</code> as a proxy for <code>serverless.com</code>, you'll need the following two templates in your <code>serverless.yml</code>:</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-comment\"># serverless.yml</span>\n<span class=\"hljs-attr\">service:</span> service-name\n<span class=\"hljs-attr\">provider:</span> aws\n<span class=\"hljs-attr\">functions:</span>\n  …\n\n<span class=\"hljs-attr\">resources:</span>\n<span class=\"hljs-attr\">  Resources:</span>\n<span class=\"hljs-attr\">    ProxyResource:</span>\n<span class=\"hljs-attr\">      Type:</span> AWS::ApiGateway::Resource\n<span class=\"hljs-attr\">      Properties:</span>\n<span class=\"hljs-attr\">        ParentId:</span>\n<span class=\"hljs-attr\">          Fn:</span>:GetAtt:\n<span class=\"hljs-bullet\">            -</span> ApiGatewayRestApi <span class=\"hljs-comment\"># our default Rest API logical ID</span>\n<span class=\"hljs-bullet\">            -</span> RootResourceId\n<span class=\"hljs-attr\">        PathPart:</span> serverless <span class=\"hljs-comment\"># the endpoint in your API that is set as proxy</span>\n<span class=\"hljs-attr\">        RestApiId:</span>\n<span class=\"hljs-attr\">          Ref:</span> ApiGatewayRestApi\n<span class=\"hljs-attr\">    ProxyMethod:</span>\n<span class=\"hljs-attr\">      Type:</span> AWS::ApiGateway::Method\n<span class=\"hljs-attr\">      Properties:</span>\n<span class=\"hljs-attr\">        ResourceId:</span>\n<span class=\"hljs-attr\">          Ref:</span> ProxyResource\n<span class=\"hljs-attr\">        RestApiId:</span>\n<span class=\"hljs-attr\">          Ref:</span> ApiGatewayRestApi\n<span class=\"hljs-attr\">        HttpMethod:</span> GET <span class=\"hljs-comment\"># the method of your proxy. Is it GET or POST or … ?</span>\n<span class=\"hljs-attr\">        MethodResponses:</span>\n<span class=\"hljs-attr\">          - StatusCode:</span> <span class=\"hljs-number\">200</span>\n<span class=\"hljs-attr\">        Integration:</span>\n<span class=\"hljs-attr\">          IntegrationHttpMethod:</span> POST\n<span class=\"hljs-attr\">          Type:</span> HTTP\n<span class=\"hljs-attr\">          Uri:</span> http://serverless.com <span class=\"hljs-comment\"># the URL you want to set a proxy to</span>\n<span class=\"hljs-attr\">          IntegrationResponses:</span>\n<span class=\"hljs-attr\">            - StatusCode:</span> <span class=\"hljs-number\">200</span></code></pre>\n<p>There's a lot going on in these two templates, but all you need to know to set up a simple proxy is setting the method &#x26;\nendpoint of your proxy, and the URI you want to set a proxy to.</p>\n<p>Now that you have these two CloudFormation templates defined in your <code>serverless.yml</code> file, you can simply run\n<code>serverless deploy</code> and that will deploy these custom resources for you along with your service and set up a proxy on your Rest API.</p>\n","__filename":"providers\\aws\\events\\apigateway.md","__url":"/providers/aws/events/apigateway/","__resourceUrl":"/providers/aws/events/apigateway/index.html","__dataUrl":"/providers/aws/events/apigateway/index.html.ca154daffac2c19ba3842e68da373332.json","type":"Page"}}}</script><script data-react-helmet="true" src="https://cdn.polyfill.io/v2/polyfill.min.js"></script><script src="/phenomic.browser.74f4a4b5a2e5af5372a1.js"></script></body></html>